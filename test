
#sort bam----------------Possible Erreur  --- Avat le Marked


#RUN for tosort in *.bam;do ./samtools view -bh -F 4 -q 30 ${tosort} sorted_${tosort};done
#index bam------ Enlever cette ligne ? 
#RUN for toindex in sorted_*.bam;do ./samtools index ${toindex};done
#move les fichiers vers gatk
RUN for sorted_bam in sorted_*.bam;do mv ${sorted_bam} ../gatk-4.1.4.0/;done
# RM -r ?
#RUN for sorted_bam in sorted_*.bam.bai;do mv ${sorted_bam} ../gatk-4.1.4.0/;done
RUN mv S288C_reference_sequence_R64-3-1_20210421.fasta ../gatk-4.1.4.0/

RUN mv S288C_reference_sequence_R64-3-1_20210421.fasta.fai ../gatk-4.1.4.0/
WORKDIR /home/Project/gatk-4.1.4.0
RUN ./gatk CreateSequenceDictionary -R S288C_reference_sequence_R64-3-1_20210421.fasta
RUN for haplo in sorted_*.bam;do ./gatk HaplotypeCaller -R S288C_reference_sequence_R64-3-1_20210421.fasta -I ${haplo} -O haplotyped_${haplo}.g.vcf.gz -ERC GVCF;done

RUN for gvdcfgz in *.g.vcf.gz;do gunzip -f ${gvdcfgz} ;done
RUN for gencover in sorted*.bam;do bedtools genomecov -ibam ${gencover} -bga > genomecov_${gencover}.txt;done
RUN tab='   ';for gvcf_file in *.sam.bam; do echo -e ${gvcf_file}${tab}${gvcf_file}.g.vcf.gz >> concatenated_gcf.sample_map; done
#----------------------------------------------
